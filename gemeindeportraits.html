<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Gemeindeportraits</title>

    <meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="css/statistik.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>

<div class="container">

    <h2>Gemeindeportraits</h2>

    <div id="karte" class="non-float">
	<div> <strong>Gemeinden</strong> (bitte wählen)
	<a class="reset" href="javascript:karte.filterAll();dc.redrawAll();" style="display: none;">zurücksetzen</a>
	<span class="reset" style="display: none;"> | Aktuell ausgewählt: <span class="filter"></span></span>
	</div>
    </div>

	<h3>Kennzahlen</h3>
	
	<div id="kennzahlen-chart" class="non-float">
		<table>
			<col width="200%">
			<col width="40%">
			<tr>
				<td>Ständige Wohnbevölkerung <span class="bevölkerungyear"></span></td>
				<td align="right"><span id="bevölkerung"></span></td>
			</tr>
			<tr>
				<td>Anteil Ausländer/innen in % <span class="bevölkerungyear"></span></td>
				<td align="right"><span id="ausländeranteil"></span></td>
			</tr>
			<tr>
				<td>Haushalte <span class="haushalteyear"></span></td>
				<td align="right"><span id="haushalte"></span></td>
			</tr>
			<tr>
				<td>Anteil Einpersonenhaushalte in % <span class="haushalteyear"></span></td>
				<td align="right"><span id="anteileinpersonenhaushalte"></span></td>
			</tr>
			<tr>
				<td>Wohnungen <span class="wohnungenyear"></span></td>
				<td align="right"><span id="wohnungen"></span></td>
			</tr>
			<tr>
				<td>Neuerstellte Wohnungen <span class="wohnungenyear"></span></td>
				<td align="right"><span id="neuwohnungen"></span></td>
			</tr>
			<tr>
				<td>Volksschüler/innen <span class="volksschüleryear"></span></td>
				<td align="right"><span id="volksschüler"></span></td>
			</tr>
			<tr>
				<td>Betriebe <span class="wirtschaftyear"></span></td>
				<td align="right"><span id="betriebe"></span></td>
			</tr>
			<tr>
				<td>Beschäftigte <span class="wirtschaftyear"></span></td>
				<td align="right"><span id="beschäftigte"></span></td>
			</tr>
			<tr>
				<td>Steuerfuss Einwohnergemeinde <span class="wirtschaftyear"></span></td>
				<td align="right"><span id="steuerfuss"></span></td>
			</tr>
		</table>
	</div>
	
	<h3>Bevölkerungsentwicklung</h3>
	
	<div id="entwicklung-chart" class="non-float">
	</div>

	<h3>Altersstruktur <span class="altersstrukturyear"></span></h3>
	
	<div id="altersstruktur-chart" class="non-float">
	</div>
	
	<h3>Wirtschaftsstruktur <span class="wirtschaftsstrukturyear"></span></h3>
	
	<div id="wirtschaftsstruktur" class="overlaycontainer" style="position: relative; width: 500px; height: 500px;">
		<div id="wirtschaftsstruktur1-chart" class="non-float" style="position: relative; z-index: 100;">
		</div>
		<div id="wirtschaftsstruktur2-chart" class="non-float" style="position: absolute; top: 0; left: 0; z-index: 99;">
	    </div>
	</div>

	<h3>Bodennutzung <span class="bodennutzungyear"></span></h3>
	
	<div id="bodennutzung-chart" class="non-float">
	</div>
	
    <div>
        <a href="javascript:dc.filterAll();%20dc.renderAll();">Reset All</a>
    </div>

</div>

<script type="text/javascript" src="js/libraries/queue.js"></script>
<script type="text/javascript" src="js/libraries/d3.js"></script>
<script type="text/javascript" src="js/libraries/crossfilter.js"></script>
<script type="text/javascript" src="js/libraries/dc.js"></script>
<script type="text/javascript" src="js/libraries/d3-tip.js"></script>
<script type="text/javascript" src="js/stat_zg_generals.js"></script>
<script type="text/javascript">
    var numberFormat = d3.format(".2f");

    var karte = dc.geoChoroplethChart("#karte");
	var bevölkerung = dc.numberDisplay("#bevölkerung");
	var ausländeranteil = dc.numberDisplay("#ausländeranteil");
	var haushalte = dc.numberDisplay("#haushalte");
	var anteileinpersonenhaushalte = dc.numberDisplay("#anteileinpersonenhaushalte");
	var bestandwohnungen = dc.numberDisplay("#wohnungen");
	var neuwohnungen = dc.numberDisplay("#neuwohnungen");
	var volksschüler = dc.numberDisplay("#volksschüler");
	var betriebe = dc.numberDisplay("#betriebe");
	var beschäftigte = dc.numberDisplay("#beschäftigte");
	var steuerfuss = dc.numberDisplay("#steuerfuss");
	
	var entwicklungsChart = dc.compositeChart("#entwicklung-chart");
	
	var altersstrukturChart = dc.barChart("#altersstruktur-chart");
	
	var wirtschaftsstrukturChart1 = dc.pieChart("#wirtschaftsstruktur1-chart");
	var wirtschaftsstrukturChart2 = dc.pieChart("#wirtschaftsstruktur2-chart");
	
	var bodennutzungChart = dc.barChart("#bodennutzung-chart");
	
	var q = queue()
		.defer(d3.csv, "data/data1.csv")
		.defer(d3.csv, "data/data2.csv")
		.defer(d3.csv, "data/data3.csv")
		.defer(d3.csv, "data/data4.csv")
		.defer(d3.csv, "data/data5.csv")
		.defer(d3.csv, "data/data6.csv")
		.defer(d3.csv, "data/data7.csv")
		.defer(d3.csv, "data/data8.csv")
		.defer(d3.csv, "data/data9.csv")
		.defer(d3.csv, "data/data10.csv");
		
	q.await(function(error, data1, data2, data3, data4, data5, data6, data7, data8, data9, data10) {
	
	meta2 = data2.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year2 = meta2.filter(function( el ) { return el.Type == "year";});
	if (year2.length == 1) {
		$(".haushalteyear").html("("+year2[0].Content+")");
	}

	meta3 = data3.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year3 = meta3.filter(function( el ) { return el.Type == "year";});
	if (year3.length == 1) {
		$(".wohnungenyear").html("("+year3[0].Content+")");
	}
	
	meta4 = data4.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year4 = meta4.filter(function( el ) { return el.Type == "year";});
	if (year4.length == 1) {
		$(".volksschüleryear").html("("+year4[0].Content+")");
	}
	
	meta5 = data5.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year5 = meta5.filter(function( el ) { return el.Type == "year";});
	if (year5.length == 1) {
		$(".wirtschaftyear").html("("+year5[0].Content+")");
	}
	
	meta6 = data6.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year6 = meta6.filter(function( el ) { return el.Type == "year";});
	if (year6.length == 1) {
		$(".steuerfussyear").html("("+year6[0].Content+")");
	}
	
	meta8 = data8.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year8 = meta8.filter(function( el ) { return el.Type == "year";});
	if (year8.length == 1) {
		$(".altersstrukturyear").html("("+year8[0].Content+")");
	}
	
	meta9 = data9.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year9 = meta9.filter(function( el ) { return el.Type == "year";});
	if (year9.length == 1) {
		$(".wirtschaftsstrukturyear").html("("+year9[0].Content+")");
	}
	
	meta10 = data10.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year10 = meta10.filter(function( el ) { return el.Type == "year";});
	if (year10.length == 1) {
		$(".bodennutzungyear").html("("+year10[0].Content+")");
	}
	
	//console.log(data8);
	
	var data = crossfilter();
	
	data.add(data1.map(function(d) {
        return {State: d["State"], Raised:d["Raised"] , "Ständige Wohnbevölkerung": d["Ständige Wohnbevölkerung"], "Ausländer/innen": d["Ausländer/innen"], "Haushalte":0, "Einpersonenhaushalte":0, "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0, "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Bodentyp":"NaN", "Fläche":0};
	}));
	data.add(data2.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte": d["Haushalte"], "Einpersonenhaushalte": d["Einpersonenhaushalte"], "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0, "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Bodentyp":"NaN", "Fläche":0};
    }));
	data.add(data3.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen": d["Wohnungen"], "Neuerstellte Wohnungen": d["Neuerstellte Wohnungen"], "Volksschüler":0, "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Bodentyp":"NaN", "Fläche":0};
    }));
	data.add(data4.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler": d["Volksschüler"], "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Bodentyp":"NaN", "Fläche":0};
    }));
	data.add(data5.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe": d["Betriebe"], "Beschäftigte": d["Beschäftigte"], "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Bodentyp":"NaN", "Fläche":0};
    }));
	data.add(data6.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":d["Steuerfuss"], "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Bodentyp":"NaN", "Fläche":0};
    }));	
	data.add(data7.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe":0, "Beschäftigte":0, "Steuerfuss":0, "Jahr":d["Jahr"], "Bevölkerung":d["Bevölkerung"], "Ausländer":d["Ausländer"], "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Bodentyp":"NaN", "Fläche":0};
    }));
	data.add(data8.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe":0, "Beschäftigte":0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":d["Alterskategorie"], "GeschlechtNation":d["Typ"], "AnzahlPersonen":d["Anzahl"], "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Bodentyp":"NaN", "Fläche":0};
    }));
	data.add(data9.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe":0, "Beschäftigte":0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":d["Sektor"], "BetriebenachSektor":d["Betriebe"], "BeschäftigtenachSektor":d["Beschäftigte"], "Bodentyp":"NaN", "Fläche":0};
    }));
	data.add(data10.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe":0, "Beschäftigte":0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Bodentyp":d["Bodentyp"], "Fläche":d["Fläche"]};
    }));

		function remove_bins(source_group) { // (source_group, bins...}
			var bins = ["", "NaN", 0];
			return {
				all:function () {
					return source_group.all().filter(function(d) {
						return bins.indexOf(d.key) === -1;
					});
				}
			};
		}	
	
		var states = data.dimension(function (d) {
            return d["State"];
        });
		var jahr = data.dimension(function (d) {
            return +d["Jahr"];
        });
        var stateRaisedSum = states.group().reduceSum(function (d) {
            return d["Raised"];
        });
        var einwohner = states.group().reduceSum(function (d) {
            return +d["Ständige Wohnbevölkerung"];
        });
		var einwohnerprojahr = jahr.group().reduceSum(function (d) {
            return +d["Bevölkerung"];
        });
		var Realeinwohnerprojahr = remove_bins(einwohnerprojahr);
		var auländeranteilprojahr = jahr.group().reduceSum(function (d) {
            return d["Ausländer"]/d["Bevölkerung"];
        });
		var Realauländeranteilprojahr = remove_bins(auländeranteilprojahr);
		
		var einwohnerTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Ständige Wohnbevölkerung"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Ständige Wohnbevölkerung"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var ausländer = states.group().reduceSum(function (d) {
            return d["Ausländer/innen"];
        });
		
		var ausländerTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Ausländer/innen"];
			  p.pop += +v["Ständige Wohnbevölkerung"];
			  p.ant = p.tot/p.pop;
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Ausländer/innen"];
			  p.pop -= +v["Ständige Wohnbevölkerung"];
			  p.ant = p.tot/p.pop;
              return p;
          },
          function () { return {n:0,tot:0,pop:0,ant:0}; }
		);
		
		/*var haushalte = states.group().reduceSum(function (d) {
            return +d["Haushalte"];
        });*/
		
		var haushalteTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Haushalte"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Haushalte"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var einpersonenhaushalteTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Einpersonenhaushalte"];
			  p.pop += +v["Haushalte"];
			  p.ant = p.tot/p.pop;
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Einpersonenhaushalte"];
			  p.pop -= +v["Haushalte"];
			  p.ant = p.tot/p.pop;
              return p;
          },
          function () { return {n:0,tot:0,pop:0,ant:0}; }
		);
		
		var wohnungen = states.group().reduceSum(function (d) {
            return +d["Wohnungen"];
        });
		
		var wohnungenTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Wohnungen"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Wohnungen"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var neuewohnungen = states.group().reduceSum(function (d) {
            return +d["Neuerstellte Wohnungen"];
        });
		
		var neuewohnungenTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Neuerstellte Wohnungen"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Neuerstellte Wohnungen"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var volksschülerInnen = states.group().reduceSum(function (d) {
            return +d["Volksschüler"];
        });
		
		var volksschülerTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Volksschüler"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Volksschüler"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var betriebegroup = states.group().reduceSum(function (d) {
            return +d["Betriebe"];
        });
		
		var betriebeTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Betriebe"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Betriebe"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var beschäftigtegroup = states.group().reduceSum(function (d) {
			return +d["Beschäftigte"];
        });
		
		var beschäftigteTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Beschäftigte"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Beschäftigte"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var steuerfussgroup = states.group().reduceSum(function (d) {
			return +d["Steuerfuss"];
        });
		
		var SteuerfussTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Steuerfuss"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Steuerfuss"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var altersstrukturStack=data.dimension(function (d) {
			return d["Alterskategorie"];
		});
				
		var AltersstrukturGroup= altersstrukturStack.group().reduce(function(p, v) {
			++p.count;
			if (v["GeschlechtNation"]=="Schweizerinnen" | v["GeschlechtNation"]=="Ausländerinnen") {
				p["Negativ"] = (p["Negativ"] || 0) + +v["AnzahlPersonen"];
				p[v["GeschlechtNation"]] = (p[v["GeschlechtNation"]] || 0) - +v["AnzahlPersonen"];
			}
			else {
				p[v["GeschlechtNation"]] = (p[v["GeschlechtNation"]] || 0) + +v["AnzahlPersonen"];
			}
			p.total += + +v["AnzahlPersonen"];
			//console.log(v);
			//console.log(p);
			return p;
		}, function(p, v) {
			--p.count;
			if (v["GeschlechtNation"]=="Schweizerinnen" | v["GeschlechtNation"]=="Ausländerinnen") {
				p["Negativ"] = (p["Negativ"] || 0) - +v["AnzahlPersonen"];
				p[v["GeschlechtNation"]] = (p[v["GeschlechtNation"]] || 0) + +v["AnzahlPersonen"];
			}
			else {
				p[v["GeschlechtNation"]] = (p[v["GeschlechtNation"]] || 0) - +v["AnzahlPersonen"];
			}
			p.total -= - +v["AnzahlPersonen"];
			return p;
		}, function() {
			return { total:0, count:0};
		});
		var RealAltersstrukturGroup = remove_bins(AltersstrukturGroup)
		
		var altersstrukturkategorien = data.dimension(function (d) {
			return d["GeschlechtNation"];
		});
		var altersstrukturGroup2 = altersstrukturkategorien.group().reduceSum(function (d) {
			return +d["AnzahlPersonen"];
		});
		var AnzahlPersonenTotal = data.groupAll().reduceSum(function (d) {
			return d["AnzahlPersonen"];
		});
		
		var SektorDimension = data.dimension(function (d) {
			return d["Sektor"];
		});
		var BetriebenachSektorGroup = SektorDimension.group().reduceSum(function (d) {
			return d["BetriebenachSektor"];
		});
		var RealBetriebenachSektorGroup = remove_bins(BetriebenachSektorGroup);
		var BeschäftigtenachSektorGroup = SektorDimension.group().reduceSum(function (d) {
			return d["BeschäftigtenachSektor"];
		});
		var RealBeschäftigtenachSektorGroup = remove_bins(BeschäftigtenachSektorGroup);
		
		var BodentypDimension = data.dimension(function (d) {
			return d["Bodentyp"];
		});
		var FlächenachBodentypGroup = BodentypDimension.group().reduceSum(function (d) {
			return d["Fläche"];
		});
		var RealFlächenachBodentypGroup = remove_bins(FlächenachBodentypGroup)
		
		var FlächeTotal = data.groupAll().reduceSum(function (d) {
			return d["Fläche"];
		});
		
		function sel_stack(i) {
			return function(d) {
				return d.value[i];
			};
		};
		
		var average = function(d) {
			return d.n ? d.tot / d.n : 0;
		};
		
		var total = function(d) {
			return d.tot;
		};
		
		var anteil = function(d) {
			return d.ant;
		};
		
		var rowCount = function(d) {
			return d.n;
		};
		
		//Karte
		
		var totalWidth = document.getElementById('karte').offsetWidth;
		var height = 350
		var scale = 81500
		var lat = 8.548589899
		var lon = 47.16479567
		
		var projection = d3.geo.mercator()
			.center([lat,lon])
			.scale(scale);
			//.translate([totalWidth/2,height/2]);

		d3.json("data/gemeinden.json", function (statesJson) {
            
			var gemeinden=["Baar", "Cham", "Hünenberg", "Menzingen", "Neuheim", "Oberägeri", "Risch", "Steinhausen", "Unterägeri", "Walchwil" ,"Zug", "See"]
			
			karte.width(990)
                    .height(500)
                    .dimension(states)
                    .group(einwohner)
					.colors(d3.scale.ordinal().domain(gemeinden)
						.range([colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], "#ccc"]))
					.colorAccessor(function(d) { 
						return d ? d.key : "See";
					})
                    //.colors(d3.scale.quantize().range(["#E2F2FF", "#C4E4FF", "#9ED2FF", "#81C5FF", "#6BBAFF", "#51AEFF", "#36A2FF", "#1E96FF", "#0089FF", "#0061B5"]))
                    //.colorDomain([0, 200])
                    //.colorCalculator(function (d) { return d ? karte.colors()(d) : '#ccc'; })
					.projection(projection)
                    .overlayGeoJson(statesJson.features, "state", function (d) {
                        return d.properties.name;
                    })
					.valueAccessor(function(kv) {
						//console.log(kv);
						return kv.value;
					})
                    .title(function (d) {
                        return "State: " + d.key + "\nTotal Amount Raised: " + numberFormat(d.value ? d.value : 0) + "M";
                    })
					.addFilterHandler(function (filters, filter) {
						if (filter != "Zugersee" && filter != "Aegerisee") {
							filters.length = 0; // empty the array
							filters.push(filter);
						}
						return filters;
						
					})
					;
			
			var number=1;
			
			bevölkerung
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(einwohnerTotal);
				
			ausländeranteil
				.valueAccessor(anteil).formatNumber(d3.format('.0%'))
				.group(ausländerTotal);
				
			haushalte
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(haushalteTotal);
				
			anteileinpersonenhaushalte
				.valueAccessor(anteil).formatNumber(d3.format('.0%'))
				.group(einpersonenhaushalteTotal);
				
			bestandwohnungen
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(wohnungenTotal);
			
			neuwohnungen
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(neuewohnungenTotal);
				
			volksschüler
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(volksschülerTotal);
				
			betriebe
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(betriebeTotal);

			beschäftigte
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(beschäftigteTotal);
			
			steuerfuss
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(SteuerfussTotal);
	
			for (i = 0; i < Realeinwohnerprojahr.all().length; i++) {
				if (typeof min == 'undefined' || min > Realeinwohnerprojahr.all()[i].key) {var min = Realeinwohnerprojahr.all()[i].key};
				if (typeof max == 'undefined' || max < Realeinwohnerprojahr.all()[i].key) {var max = Realeinwohnerprojahr.all()[i].key};
			}
			
			entwicklungsChart
				.width(500)
				.height(500)
				.transitionDuration(1500)
				.margins({left: 55, top: 10, right: 50, bottom: 40})
				.dimension(jahr)
				.group(Realeinwohnerprojahr)
				.x(d3.scale.linear().domain([min-1,max+1]))
				//.x(d3.scale.ordinal())
				//.xUnits(dc.units.ordinal)
				.elasticY(true)
				.brushOn(false)
				._rangeBandPadding(1)
				.compose([
					dc.barChart(entwicklungsChart)
						.group(Realeinwohnerprojahr, "Bevölkerung")
						.ordinalColors([colorscheme[1][2][0]])
						.yAxisPadding("10%")
						.gap(40)
						.centerBar(true)
						.title(function(d) {
							return ""; 
						}),
					dc.lineChart(entwicklungsChart)
						.group(Realauländeranteilprojahr, "Anteil Ausländer/innen in %")
						.yAxisPadding("10%")
						.ordinalColors([colorscheme[1][2][1]])
						.useRightYAxis(true)
						.interpolate("linear")
						.dotRadius(10)
						.title(function(d) {
							return ""; 
						})
				])
				.yAxisLabel("Bevölkerung")
				.rightYAxisLabel("Anteil Ausländer/innen in %")
				.renderHorizontalGridLines(true)
				.legend(dc.legend().x(100).y(20).itemHeight(13).gap(10)
				.horizontal(true)
				.legendWidth(400)
				.autoItemWidth(true))
				.filter = function() {}
				;
			
			entwicklungsChart.yAxis().tickFormat(germanFormatters.numberFormat(","));
			entwicklungsChart.xAxis().tickFormat(germanFormatters.numberFormat(""));
			entwicklungsChart.rightYAxis().tickFormat(d3.format('.0%'));
			
			var characteristics=["Schweizerinnen", "Ausländerinnen", "Negativ", "Schweizer", "Ausländer"]
			var characteristicsStack=["0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90-94", "95-99", "100+"]
			var colorsAltersstruktur=[colorscheme[1][4][2], colorscheme[1][4][3],  ,colorscheme[1][4][1], colorscheme[1][4][0]];
			
			altersstrukturChart
				.width(500)
				.height(500)
				.x(d3.scale.ordinal())
				.xUnits(dc.units.ordinal)
				.margins({left: 50, top: 10, right: 10, bottom: 40})
				.brushOn(false)
				.barPadding(0.2)
				.outerPadding(0.2)
				.centerBar(false)
				//.clipPadding(1)
				.controlsUseVisibility(true)
				.title(function(d) {
					return ""; //d.key + '[' + this.layer + ']: ' + d.value[this.layer] + " " + d.value["total"];
				})
				.dimension(altersstrukturStack)
				.group(RealAltersstrukturGroup, characteristics[0] + "", sel_stack(characteristics[0]))
				//.renderLabel(true)
				.ordinalColors(colorsAltersstruktur)
				.transitionDuration(1500)
				.yAxisPadding("5%")
				.elasticY(true)
				.filter = function() {}
				;

			if (typeof relative !== 'undefined' && relative==true) {
				altersstrukturChart.yAxis().tickFormat(d3.format('.0%'));
				altersstrukturChart.renderLabel(false)
				altersstrukturChart.yAxisPadding("0%");
			}
			else {
				//altersstrukturChart.yAxis().tickFormat(germanFormatters.numberFormat(","));	
			}

			if (typeof characteristicsStack !== []) {
			altersstrukturChart.x(d3.scale.ordinal().domain(characteristicsStack));
			}

			//Farben in der Legende manuell zuweisen. funktionier nicht mit der Legende.
			/*Charts[number].on('renderlet', function(chart){
				for (var i=1; i<=characteristicsLength; ++i) {
				var j=i-1;
				chart.selectAll("g.stack._"+j+" > rect").attr("fill", function(d){
					return colorscheme[scale][characteristicsLength][i-1];
					
				});
				chart.selectAll("g.dc-legend-item:nth-child("+i+") > rect").attr("fill", function(d){
					return colorscheme[scale][characteristicsLength][i-1];
					
				});}
				})*/

			altersstrukturChart.legend(dc.legend().x(10).y(10).itemHeight(13).gap(10)
						.horizontal(false)
						//.legendWidth(500-10)
						.autoItemWidth(true));

			//Legende Anders ordnen
			dc.override(altersstrukturChart, 'legendables', function() {
				var items = altersstrukturChart._legendables();
				items.splice(2, 1);
				items.splice(3, 1, items.splice(2, 1)[0])
				items.splice(3, 1, items.splice(0, 1)[0])
				items.splice(3, 1, items.splice(0, 1)[0])
				return items;
			});

			for(var i = 1; i < 5; ++i){
				altersstrukturChart.stack(RealAltersstrukturGroup, characteristics[i], sel_stack(characteristics[i]));
			}
			
			altersstrukturChart.on('pretransition', function(c) {
				c.svg().select('g').attr("transform","rotate(270 250,250)");
				c.svg().selectAll('g.axis:nth-child(2) > g > text').attr("transform","translate(12,25) rotate(90 0,0)");
				c.svg().select('g:nth-child(3) > g:nth-child(3)').attr("transform","translate(12,25) rotate(90 0,0)");
				c.svg().selectAll('g.axis:nth-child(3) > g > text').each(function(d, i) {
					d3.select(this).text(d3.select(this).text().replace("-",""));
				});
			});
			
			altersstrukturChart.yAxis().tickFormat(germanFormatters.numberFormat(","));
			
			var characteristicsWirtschaftsstruktur=["Land- und Forstwirtschaft", "Industrie und Gewerbe", "Dienstleistung"]
			
			var colorScaleWirtschaftstruktur = d3.scale.ordinal()
            .domain(characteristicsWirtschaftsstruktur)
            .range([colorscheme[1][3][2],colorscheme[1][3][1],colorscheme[1][3][0]]);
			
			wirtschaftsstrukturChart1.width(500)
				.cx(250)
				.cy(250)
				.height(500)
				.slicesCap(15)
				.dimension(SektorDimension)
				.group(RealBetriebenachSektorGroup)
				.controlsUseVisibility(true)
				.externalRadiusPadding(50)
				.emptyTitle("Keine Daten vorhanden")
				.innerRadius(150)
				.colors(colorScaleWirtschaftstruktur)
				.transitionDuration(1500)
				.title(function(d) {
					return ""; 
				})
				.ordering(function(d) { return characteristicsWirtschaftsstruktur.indexOf(d.key); })
				.legend(dc.legend().x(10).y(10).itemHeight(13).gap(10)
					.horizontal(false))
				.on('renderlet', function(chart){
					//Labels mit Prozentzahlen ersetzen
					chart.selectAll('text.pie-slice').text( function(d) {
						if (dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI) * 100) > 4) {
							return d3.format(".1%")(dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI)*100)/100);
						};
					});
				})
				.filter = function() {}
				;
				
			wirtschaftsstrukturChart2.width(500)
				.cx(250)
				.cy(250)
				.height(500)
				.slicesCap(15)
				.dimension(SektorDimension)
				.group(RealBeschäftigtenachSektorGroup)
				.controlsUseVisibility(true)
				.externalRadiusPadding(100)
				.emptyTitle("Keine Daten vorhanden")
				.innerRadius(100)
				.colors(colorScaleWirtschaftstruktur)
				.transitionDuration(1500)
				.title(function(d) {
					return ""; 
				})
				.ordering(function(d) { return characteristicsWirtschaftsstruktur.indexOf(d.key); })
				.on('renderlet', function(chart){
					//Labels mit Prozentzahlen ersetzen
					chart.selectAll('text.pie-slice').text( function(d) {
						if (dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI) * 100) > 4) {
							return d3.format(".1%")(dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI)*100)/100);
						};
					});
				})
				.filter = function() {}
				;
			
			characteristicsBodennutzung=["Siedlungsfläche", "Landwirtschaftsfläche", "Bestockte Fläche", "Gewässer", "Vegetationslose Fläche"]
			
			var colorScaleBodennutzung = d3.scale.ordinal()
				.domain(characteristicsBodennutzung)
				.range([colorscheme[1][12][11], colorscheme[1][12][3], colorscheme[1][12][2], colorscheme[1][12][0], colorscheme[1][12][8]]);
			
			bodennutzungChart
				.width(500)
				.height(500)
				.x(d3.scale.ordinal())
				.xUnits(dc.units.ordinal)
				.margins({left: 50, top: 10, right: 10, bottom: 20})
				.brushOn(false)
				.barPadding(0.2)
				.outerPadding(0.2)
				.centerBar(false)
				//.clipPadding(1)
				.controlsUseVisibility(true)
				.title(function(d) {
					return ""; //d.key + '[' + this.layer + ']: ' + d.value[this.layer] + " " + d.value["total"];
				})
				.dimension(BodentypDimension)
				.group(RealFlächenachBodentypGroup)
				.renderLabel(true)
				.colors(colorScaleBodennutzung)
				.colorAccessor(function(d) { 
					return d.key
				})
				//.ordinalColors([colorscheme[1][12][11], colorscheme[1][12][3], colorscheme[1][12][2], colorscheme[1][12][0], colorscheme[1][12][0]])
				.transitionDuration(1500)
				.yAxisPadding("5%")
				.ordering(function(d) { return characteristicsBodennutzung.indexOf(d.key); })
				.filter = function() {}
				;

            dc.renderAll();
			
			if (typeof Tips == 'undefined') { Tips = {} };
			
			function initTip(number){
				last_tip = null;
				Tips[number] = d3.tip()
					.attr('class', 'd3-tip')
					.attr('id', 'd3-tip'+number)
					.direction('n')
					.offset([0, 0])
					.html("no data");
				$(".pie-label").css( 'pointer-events', 'none' );
			}
			
			function callTipKarte(number){
	
				//Nur für Gemeinden, nicht für Seen, deshalb Zwischenschritt
				var gemeinden = d3.selectAll("#karte svg g path").filter(function(d,i) {return d.id < 2000});
				
				gemeinden.each(function(d, i){
					d3.select(this)
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.key !== last_tip) {
							Tips[number].show(d, $("circle")[d.ind]);
							last_tip = d.key;
						}
						console.log(d);
						tiptext= "<span><b>" + d.properties.name + "</b></span><br/><br/><span><img src='logos/"+ d.properties.name+ ".png' alt='' width='170' ></span>";
						$("#d3-tip"+number).html(tiptext);
						$("#d3-tip"+number).css("background", "#fff");
						$("#d3-tip"+number).css("border-left", colorscheme[1][2][0]+" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 18 - ($("#d3-tip"+number).width()/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) + 0 - ($("#d3-tip"+number).height()));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
					})
				})
			}
			
			function callTipBevölkerungsentwicklung(number){
				d3.selectAll("#entwicklung-chart g.stack > rect")
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.key !== last_tip) {
							Tips[number].show(d);
							last_tip = d.key;
						}
						if (d.data.value % 1) {wert=germanFormatters.numberFormat(",.1f")(d.data.value)}
						else {wert=germanFormatters.numberFormat(",")(d.data.value)}
						tiptext= "<span>" + d.data.key + "</span><br/><span>Einwohnerzahl: " +wert+  "</span>";
						$("#d3-tip"+number).html(tiptext)
						$("#d3-tip"+number).css("border-left", colorscheme[1][2][0]+" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 33 - (($("#d3-tip"+number).width()+30)/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) +5 - (($("#d3-tip"+number).height()+18)/2));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
					});
				d3.selectAll("circle.dot")
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.data.key !== last_tip) {
							Tips[number].show(d);
							last_tip = d.data.key;
						}
						tiptext= "<span>" + d.data.key + "</span><br/><span>Anteil: " + d3.format('.1%')(d.data.value) + "</span>";
						$("#d3-tip"+number).html(tiptext)
						$("#d3-tip"+number).css("border-left", colorscheme[1][2][1] +" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 33 - (($("#d3-tip"+number).width()+30)/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) + 5 - (($("#d3-tip"+number).height()+18)/2));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
						//document.getElementsByClassName("dot")
						d3.selectAll("circle.dot").attr('style', "fill-opacity:0.000001");
						d3.selectAll("path.yRef").attr('style', "display:none");
						d3.selectAll("path.xRef").attr('style', "display:none");
					});
			}
			
			function callTipAltersstruktur(number){
				d3.selectAll("#altersstruktur-chart g.stack > rect")
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.key !== last_tip) {
							Tips[number].show(d);
							last_tip = d.key;
						}
						if (d.data.value[characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]] % 1) {wert=germanFormatters.numberFormat(",.1f")(Math.abs(d.data.value[characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]]))}
						else {wert=germanFormatters.numberFormat(",")(Math.abs(d.data.value[characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]]))}
						tiptext= "<span>"+characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]+" "+ d.data.key+ " Jahre</span><br/><span>Anteil in der Altersgruppe: " + Math.abs((Math.round((d.data.value[characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]]/d.data.value["total"])*1000)/10).toFixed(1)) + '%' + "</span><br/><span>Anteil Gesamtbevölkerung: " + Math.abs((Math.round((d.data.value[characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]]/AnzahlPersonenTotal.value())*1000)/10).toFixed(1)) + '%' + " </span><br/><span>Anzahl: " + wert +  "</span>";
						$("#d3-tip"+number).html(tiptext)
						$("#d3-tip"+number).css("border-left", colorsAltersstruktur[Math.floor(i/RealAltersstrukturGroup.all().length)] +" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 33 - (($("#d3-tip"+number).width()+30)/2) + ((d3.selectAll("#altersstruktur-chart g.stack > rect")[0][i].height.baseVal.value)/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) + 5 - ($("#d3-tip"+number).height()+18/2));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
					});
			}

			function callTipWirtschaftsstruktur(number){
				d3.selectAll("#wirtschaftsstruktur"+number+"-chart g.pie-slice, #wirtschaftsstruktur"+number+"-chart text.pie-slice")
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.key !== last_tip) {
							Tips[number].show(d, $("#wirtschaftsstruktur"+number+"-chart g.pie-slice")[characteristicsWirtschaftsstruktur.indexOf(d.data.key)]);
							last_tip = d.key;
						}
						if (d.data.value % 1) {wert=germanFormatters.numberFormat(",.1f")(d.data.value)}
						else {wert=germanFormatters.numberFormat(",")(d.data.value)}
						if (number==1) {var gruppe="Anzahl Betriebe"} else {var gruppe="Anzahl Beschäftigte"};
						tiptext="<span>" + d.data.key + "</span><br/>Anteil: " + germanFormatters.numberFormat(",.1%")(dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI)*100)/100) + "</span><br/><span>"+gruppe+": " + wert + "</span>"
						$("#d3-tip"+number).html(tiptext)
						$("#d3-tip"+number).css("border-left", colorScaleWirtschaftstruktur(d.data.key)+" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 18 - ($("#d3-tip"+number).width()/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) -10 - ($("#d3-tip"+number).height()/2));
						console.log(offsetx);
						console.log(offsety);
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
					});
			}
			
			function callTipBodennutzung(number){
				d3.selectAll("#bodennutzung-chart g.stack > rect")
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.key !== last_tip) {
							Tips[number].show(d);
							last_tip = d.key;
						}
						if (d.data.value % 1) {wert=germanFormatters.numberFormat(",.1f")(d.data.value)}
						else {wert=germanFormatters.numberFormat(",")(d.data.value)}
						tiptext= "<span>" + d.data.key + "</span><br/><span>Anteil: " + germanFormatters.numberFormat(",.1%")(d.data.value/FlächeTotal.value()) + "</span><br/><span>Fläche: " +wert+  " ha</span>";
						$("#d3-tip"+number).html(tiptext)
						$("#d3-tip"+number).css("border-left", colorScaleBodennutzung(d.data.key)+" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 20 - ($("#d3-tip"+number).width()/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) -18 - ($("#d3-tip"+number).height()/2));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
					});
			}
			
			
			initTip("karte");
			callTipKarte("karte");
			initTip("bevölkerungsentwicklung");
			callTipBevölkerungsentwicklung("bevölkerungsentwicklung");
			initTip("altersstruktur");
			callTipAltersstruktur("altersstruktur");
			initTip(1);
			callTipWirtschaftsstruktur(1);
			initTip(2);
			callTipWirtschaftsstruktur(2);
			initTip("bodennutzung");
			callTipBodennutzung("bodennutzung");
			
$(".dc-legend-item text").attr("x", 17);
$("title").remove();
//$("#altersstruktur-chart g.axis.y g.tick text").text($("#altersstruktur-chart g.axis.y g.tick text").text().replace('-', ''));
		
//Kuchendiagramm mit Pfeilen ergänzen

$( document ).ready(function() {

			function formatBarLabels(){
					d3.selectAll("#bodennutzung-chart text.barLabel").each(function(d, i) {
					if (d.data.value % 1) {wert=(germanFormatters.numberFormat(",.1f")(d.data.value))+" ha"}
					else {wert=(germanFormatters.numberFormat(",")(d.data.value))+" ha"}
					d3.select(this).text(wert);
				});
			}

			formatBarLabels();

	setTimeout(function() {

		var arrowhead="M374.203,1150c-25.391,0-50.818-9.721-70.199-29.044c-38.789-38.834-38.789-101.685,0-140.376L685.37,599.14L305.74,219.451c-38.716-38.741-38.716-101.614,0-140.379c38.799-38.763,101.663-38.763,140.389,0l449.857,449.915 c18.58,18.629,29.103,43.84,29.103,70.153c0,26.339-10.523,51.551-29.103,70.226l-451.592,451.59 C425.012,1140.279,399.621,1150,374.203,1150z"
		var markerblack={"id":"arrowblack", "viewBox":"0 -5 1200 1200", "refX":-200, "refY":600, "markerWidth":3, "markerHeight":3, "orient":"auto"};
		
		svg = d3.selectAll("#wirtschaftsstruktur1-chart svg")
		
		svg.append("marker")
			.attr(markerblack)
			.append("path")
				.attr("d", arrowhead)
				.attr("class","arrowHead")
				.attr("fill", "#32444a")
				//.attr("fill-opacity", "0.5");
						
		svg.append("path")
			.attr("class", "line")
				.attr("id", "line1")
				.attr("stroke-width", 5)
				.attr("stroke", "#32444a")
				.attr("fill", "none")
				.attr("stroke-linecap", "round")
				//.attr("stroke-opacity", "0.5")
				.attr({
					"class":"comingline",
					"marker-end":"url(#arrowblack)"
				})
				.attr("d", function(d) {
					/*var scalewidth=1*d3.transform(svg.select("g.axis.y").attr("transform")).translate[0];
					var rectwidth=svg.select("g.sub._0 rect:nth-child(1)").attr("width");
					var y1=svg.select("g.sub._0 rect:nth-child(1)").attr("y")-5;
					var x1=(1*svg.select("g.sub._0 rect:nth-child(1)").attr("x"))+scalewidth+rectwidth/2;
					var y2=svg.select("g.sub._0 rect:nth-child(2)").attr("y")-5;
					var x2=(1*svg.select("g.sub._0 rect:nth-child(2)").attr("x"))+scalewidth+rectwidth/2-20;*/
					return "M"+210+","+230+" "+410+" "+230;
				});
				
		svg.append("text")
 		      	.attr("x", "210")
				.attr("y","220")
				.attr("font-size", "20")
				.attr("fill", "#32444a")
				.text("Betriebe");	
				
		svg.append("path")
			.attr("class", "line")
				.attr("id", "line1")
				.attr("stroke-width", 5)
				.attr("stroke", "#32444a")
				.attr("fill", "none")
				.attr("stroke-linecap", "round")
				//.attr("stroke-opacity", "0.5")
				.attr({
					"class":"comingline",
					"marker-end":"url(#arrowblack)"
				})
				.attr("d", function(d) {
					/*var scalewidth=1*d3.transform(svg.select("g.axis.y").attr("transform")).translate[0];
					var rectwidth=svg.select("g.sub._0 rect:nth-child(1)").attr("width");
					var y1=svg.select("g.sub._0 rect:nth-child(1)").attr("y")-5;
					var x1=(1*svg.select("g.sub._0 rect:nth-child(1)").attr("x"))+scalewidth+rectwidth/2;
					var y2=svg.select("g.sub._0 rect:nth-child(2)").attr("y")-5;
					var x2=(1*svg.select("g.sub._0 rect:nth-child(2)").attr("x"))+scalewidth+rectwidth/2-20;*/
					return "M"+210+","+280+" "+355+" "+280;
				});
			
		svg.append("text")
 		      	.attr("x", "210")
				.attr("y","270")
				.attr("font-size", "20")
				.attr("fill", "#32444a")
				.text("Beschäftigte");	
				
    }, 1000);
	
});

			$("g.stack:nth-child(3)").hide();
			$('#wirtschaftsstruktur1-chart').css( 'pointer-events', 'none' );
			$('.pie-slice').css( 'pointer-events', 'all' );
			//$('g.aegerisee').css( 'pointer-events', 'none' );
			$( document ).ready(function() {
			setTimeout(
				function() 
				{

				}, 1000);
			});
        });
});
</script>

</body></html>