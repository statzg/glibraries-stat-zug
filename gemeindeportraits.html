<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Gemeindeportraits</title>

    <meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="css/statistik.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
<style>
@font-face { 
  font-family: 'CorporateS-Demi';
  src: url('font/CorporateS-Demi.eot?#iefix') format('embedded-opentype'),  url('font/CorporateS-Demi.otf')  format('opentype'),
	     url('font/CorporateS-Demi.woff') format('woff'), url('font/CorporateS-Demi.ttf')  format('truetype'), url('font/CorporateS-Demi.svg#CorporateS-Demi') format('svg');
  font-weight: normal;
  font-style: normal;
}
@font-face { 
  font-family: 'CorporateS-Light';
  src: url('font/CorporateS-Light.eot?#iefix') format('embedded-opentype'),  url('font/CorporateS-Light.otf')  format('opentype'),
	     url('font/CorporateS-Light.woff') format('woff'), url('font/CorporateS-Light.ttf')  format('truetype'), url('font/CorporateS-Light.svg#CorporateS-Light') format('svg');
  font-weight: normal;
  font-style: normal;
}
body { font-family: 'CorporateS-Demi' !important; }

div.dc-chart { font-family: 'CorporateS-Light' !important; }

.dc-chart .axis text, .axis text {
    fill: #000;
    font-size: 12px;
}

.dc-legend {
	font-size:14px;
}

.dc-chart .pie-slice.pie-label {
    fill: #000;
    font-size: 12px;
}

text.barLabel {
    fill: #000;
    font-size: 12px;
}
</style>



<div class="container" style="width:1200px;">

    <h1 style="display: block; width:1200px; overflow: auto;">
		<span id="maintitle">Kantonsportrait</span>
		<img id="mainflag" src="" style="margin: 0 30px; vertical-align: middle">
		<img src="logos/logo-kanton.png" height="100px" align="right" style="vertical-align: middle;"></h1>

	<table style="width:1200px">
		<tr>
			<td valign="top" style="width:50%; padding:10px 20px;">
				<h3>Kennzahlen</h3>
				<div id="kennzahlen-chart" class="non-float">
					<table>
						<col width="70%">
						<col width="30%">
						<tr>
							<td>Ständige Wohnbevölkerung <span class="bevölkerungyear"></span></td>
							<td align="right"><span id="bevölkerung"></span></td>
						</tr>
						<tr>
							<td>Anteil Ausländer/innen in % <span class="bevölkerungyear"></span></td>
							<td align="right"><span id="ausländeranteil"></span></td>
						</tr>
						<tr>
							<td>Haushalte <span class="haushalteyear"></span></td>
							<td align="right"><span id="haushalte"></span></td>
						</tr>
						<tr>
							<td>Anteil Einpersonenhaushalte in % <span class="haushalteyear"></span></td>
							<td align="right"><span id="anteileinpersonenhaushalte"></span></td>
						</tr>
						<tr>
							<td>Wohnungen <span class="wohnungenyear"></span></td>
							<td align="right"><span id="wohnungen"></span></td>
						</tr>
						<tr>
							<td>Neuerstellte Wohnungen <span class="neubauwohnungenyear"></span></td>
							<td align="right"><span id="neuwohnungen"></span></td>
						</tr>
						<tr>
							<td>Volksschüler/innen <span class="volksschüleryear"></span></td>
							<td align="right"><span id="volksschüler"></span></td>
						</tr>
						<tr>
							<td>Betriebe <span class="wirtschaftyear"></span></td>
							<td align="right"><span id="betriebe"></span></td>
						</tr>
						<tr>
							<td>Beschäftigte <span class="wirtschaftyear"></span></td>
							<td align="right"><span id="beschäftigte"></span></td>
						</tr>
						<tr>
							<td>Steuerfuss Einwohnergemeinde <span class="wirtschaftyear"></span></td>
							<td align="right"><span id="steuerfuss"></span></td>
						</tr>
					</table>
				</div>
			</td>
			<td valign="top" style="width:50%; padding:10px 20px;">
				<div id="karte" class="non-float" >
				<!--<div> <strong>Gemeinden</strong> (bitte wählen)
				<a class="reset" href="javascript:karte.filterAll();dc.redrawAll();" style="display: none;">zurücksetzen</a>
				<span class="reset" style="display: none;"> | Aktuell ausgewählt: <span class="filter"></span></span>
				</div>-->
				</div>
			</td>
		</tr>
		<tr>
			<td valign="top" style="width:50%; padding:10px 20px;">
				<h3>Bevölkerungsentwicklung</h3>
				<div id="entwicklung-chart" class="non-float">
				</div>
			</td>
			<td valign="top" style="width:50%; padding:10px 20px;">
				<h3>Altersstruktur <span class="altersstrukturyear"></span></h3>
				<div id="altersstruktur-chart" class="non-float" style="text-align:center; display:block;">
				</div>
			</td>
		</tr>
		<tr>
			<td valign="top" style="width:50%; padding:10px 20px;">
				<h3>Wirtschaftsstruktur <span class="wirtschaftsstrukturyear"></span></h3>
				<div id="wirtschaftsstruktur" class="overlaycontainer" style="position: relative;">
					<div id="wirtschaftsstruktur1-chart" class="non-float" style="position: relative; z-index: 100;">
					</div>
					<div id="wirtschaftsstruktur2-chart" class="non-float" style="position: absolute; top: 0; left: 0; z-index: 99;">
					</div>
				</div>
			</td>
			<td valign="top" style="width:50%; padding:10px 20px;">
				<h3>Raumstruktur (Bauzonen) <span class="bauzonenyear"></span></h3>
				<div id="bauzonen-chart" class="non-float">
				</div>
			</td>
		</tr>
	</table>
</div>
<div>Herausgeberin: Amt für Raumplanung des Kantons Zug, Fachstelle für Statistik. Datenquellen: Bundesamt für Statistik.</div>
<div>Stand Februar 2018. Interessiert an weiteren statistischen Informationen? Besuchen Sie uns im Internet: <a href="http://www.zg.ch/statistik" target="_blank">www.zg.ch/statistik</a></div>

<script type="text/javascript" src="js/libraries/queue.js"></script>
<script type="text/javascript" src="js/libraries/d3.js"></script>
<script type="text/javascript" src="js/libraries/crossfilter.js"></script>
<script type="text/javascript" src="js/libraries/dc.js"></script>
<script type="text/javascript" src="js/libraries/d3-tip.js"></script>
<script type="text/javascript" src="js/stat_zg_generals.js"></script>
<script type="text/javascript">
    var numberFormat = d3.format(".2f");

    var karte = dc.geoChoroplethChart("#karte");
	var bevölkerung = dc.numberDisplay("#bevölkerung");
	var ausländeranteil = dc.numberDisplay("#ausländeranteil");
	var haushalte = dc.numberDisplay("#haushalte");
	var anteileinpersonenhaushalte = dc.numberDisplay("#anteileinpersonenhaushalte");
	var bestandwohnungen = dc.numberDisplay("#wohnungen");
	var neuwohnungen = dc.numberDisplay("#neuwohnungen");
	var volksschüler = dc.numberDisplay("#volksschüler");
	var betriebe = dc.numberDisplay("#betriebe");
	var beschäftigte = dc.numberDisplay("#beschäftigte");
	var steuerfuss = dc.numberDisplay("#steuerfuss");
	
	var entwicklungsChart = dc.compositeChart("#entwicklung-chart");
	
	var altersstrukturChart = dc.barChart("#altersstruktur-chart");
	
	var wirtschaftsstrukturChart1 = dc.pieChart("#wirtschaftsstruktur1-chart");
	var wirtschaftsstrukturChart2 = dc.pieChart("#wirtschaftsstruktur2-chart");
	
	var bauzonenChart = dc.barChart("#bauzonen-chart");
	
	var q = queue()
		.defer(d3.csv, "data/result-data1.csv")
		.defer(d3.csv, "data/result-data2.csv")
		.defer(d3.csv, "data/result-data3.csv")
		.defer(d3.csv, "data/result-data4.csv")
		.defer(d3.csv, "data/result-data5.csv")
		.defer(d3.csv, "data/result-data6.csv")
		.defer(d3.csv, "data/result-data7.csv")
		.defer(d3.csv, "data/result-data8.csv")
		.defer(d3.csv, "data/result-data9.csv")
		.defer(d3.csv, "data/result-data10.csv")
		.defer(d3.csv, "data/result-data11.csv");
		
	q.await(function(error, data1, data2, data3, data4, data5, data6, data7, data8, data9, data10, data11) {

	meta1 = data1.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year1 = meta1.filter(function( el ) { return el.Type == "year";});
	if (year1.length == 1) {
		$(".bevölkerungyear").html("("+year1[0].Content+")");
	}
	
	meta2 = data2.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year2 = meta2.filter(function( el ) { return el.Type == "year";});
	if (year2.length == 1) {
		$(".haushalteyear").html("("+year2[0].Content+")");
	}

	meta3 = data3.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year3 = meta3.filter(function( el ) { return el.Type == "year";});
	if (year3.length == 1) {
		$(".wohnungenyear").html("("+year3[0].Content+")");
	}
	
	meta4 = data4.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year4 = meta4.filter(function( el ) { return el.Type == "year";});
	if (year4.length == 1) {
		$(".neubauwohnungenyear").html("("+year4[0].Content+")");
	}
	
	meta5 = data5.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year5 = meta5.filter(function( el ) { return el.Type == "year";});
	if (year5.length == 1) {
		$(".volksschüleryear").html("("+year5[0].Content+")");
	}
	
	meta6 = data6.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year6 = meta6.filter(function( el ) { return el.Type == "year";});
	if (year6.length == 1) {
		$(".wirtschaftyear").html("("+year6[0].Content+")");
	}
	
	meta7 = data7.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year7 = meta7.filter(function( el ) { return el.Type == "year";});
	if (year7.length == 1) {
		$(".steuerfussyear").html("("+year7[0].Content+")");
	}
	
	meta9 = data9.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year9 = meta9.filter(function( el ) { return el.Type == "year";});
	if (year9.length == 1) {
		$(".altersstrukturyear").html("("+year9[0].Content+")");
	}
	
	meta10 = data10.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year10 = meta10.filter(function( el ) { return el.Type == "year";});
	if (year10.length == 1) {
		$(".wirtschaftsstrukturyear").html("("+year10[0].Content+")");
	}
	
	meta11 = data11.filter(function(el) {
		return el["Meta"] == 1
	});
	
	year11 = meta11.filter(function( el ) { return el.Type == "year";});
	if (year11.length == 1) {
		$(".bauzonenyear").html("("+year11[0].Content+")");
	}
	
	var data = crossfilter();
	
	data.add(data1.map(function(d) {
        return {State: d["State"], Raised:d["Raised"] , "Ständige Wohnbevölkerung": d["Ständige Wohnbevölkerung"], "Ausländer/innen": d["Ausländer/innen"], "Haushalte":0, "Einpersonenhaushalte":0, "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0, "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Zone":"NaN", "Fläche":0};
	}));
	data.add(data2.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte": d["Haushalte"], "Einpersonenhaushalte": d["Einpersonenhaushalte"], "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0, "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Zone":"NaN", "Fläche":0};
    }));
	data.add(data3.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen": d["Wohnungen"], "Neuerstellte Wohnungen": 0, "Volksschüler":0, "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Zone":"NaN", "Fläche":0};
    }));
	data.add(data4.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen": d["Neuerstellte Wohnungen"], "Volksschüler":0, "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Zone":"NaN", "Fläche":0};
    }));
	data.add(data5.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler": d["Volksschüler"], "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Zone":"NaN", "Fläche":0};
    }));
	data.add(data6.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe": d["Betriebe"], "Beschäftigte": d["Beschäftigte"], "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Zone":"NaN", "Fläche":0};
    }));
	data.add(data7.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe": 0, "Beschäftigte": 0, "Steuerfuss":d["Steuerfuss"], "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Zone":"NaN", "Fläche":0};
    }));	
	data.add(data8.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe":0, "Beschäftigte":0, "Steuerfuss":0, "Jahr":d["Jahr"], "Bevölkerung":d["Bevölkerung"], "Ausländer":d["Ausländer"], "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Zone":"NaN", "Fläche":0};
    }));
	data.add(data9.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe":0, "Beschäftigte":0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":d["Alterskategorie"], "GeschlechtNation":d["Typ"], "AnzahlPersonen":d["Anzahl"], "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Zone":"NaN", "Fläche":0};
    }));
	data.add(data10.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe":0, "Beschäftigte":0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":d["Sektor"], "BetriebenachSektor":d["Betriebe"], "BeschäftigtenachSektor":d["Beschäftigte"], "Zone":"NaN", "Fläche":0};
    }));
	data.add(data11.map(function(d) {
        return {State: d["State"], Raise:0, "Ständige Wohnbevölkerung":0, "Ausländer/innen":0,  "Haushalte":0, "Einpersonenhaushalte":0 , "Wohnungen":0, "Neuerstellte Wohnungen":0, "Volksschüler":0 , "Betriebe":0, "Beschäftigte":0, "Steuerfuss":0, "Jahr":0, "Bevölkerung":0, "Ausländer":0, "Alterskategorie":"NaN", "GeschlechtNation":"NaN", "AnzahlPersonen":0, "Sektor":"NaN", "BetriebenachSektor":0, "BeschäftigtenachSektor":0, "Zone":d["Zone"], "Fläche":d["Fläche"]};
    }));

		function remove_bins(source_group) { // (source_group, bins...}
			var bins = ["", "NaN", 0];
			return {
				all:function () {
					return source_group.all().filter(function(d) {
						return bins.indexOf(d.key) === -1;
					});
				}
			};
		}	
	
		var states = data.dimension(function (d) {
            return d["State"];
        });
		var jahr = data.dimension(function (d) {
            return +d["Jahr"];
        });
        var stateRaisedSum = states.group().reduceSum(function (d) {
            return d["Raised"];
        });
        var einwohner = states.group().reduceSum(function (d) {
            return +d["Ständige Wohnbevölkerung"];
        });
		var einwohnerprojahr = jahr.group().reduceSum(function (d) {
            return +d["Bevölkerung"];
        });
		var Realeinwohnerprojahr = remove_bins(einwohnerprojahr);
		
		var ausländeranteilprojahr = jahr.group().reduce(
          function (p, v) {
			++p.n;
            p.tot += +v["Ausländer"];
			p.pop += +v["Bevölkerung"];
			p.ant = p.tot/p.pop;
			return p;
          },
          function (p, v) {
            --p.n
			p.tot -= +v["Ausländer"];
			p.pop -= +v["Bevölkerung"];
			p.ant = p.tot/p.pop;
            return p;
          },
          function () { return {n:0,tot:0,pop:0,ant:0}; }
		);
		
		var Realausländeranteilprojahr = remove_bins(ausländeranteilprojahr);
		
		var einwohnerTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Ständige Wohnbevölkerung"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Ständige Wohnbevölkerung"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var ausländer = states.group().reduceSum(function (d) {
            return d["Ausländer/innen"];
        });
		
		var ausländerTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Ausländer/innen"];
			  p.pop += +v["Ständige Wohnbevölkerung"];
			  p.ant = p.tot/p.pop;
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Ausländer/innen"];
			  p.pop -= +v["Ständige Wohnbevölkerung"];
			  p.ant = p.tot/p.pop;
              return p;
          },
          function () { return {n:0,tot:0,pop:0,ant:0}; }
		);
		
		/*var haushalte = states.group().reduceSum(function (d) {
            return +d["Haushalte"];
        });*/
		
		var haushalteTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Haushalte"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Haushalte"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var einpersonenhaushalteTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Einpersonenhaushalte"];
			  p.pop += +v["Haushalte"];
			  p.ant = p.tot/p.pop;
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Einpersonenhaushalte"];
			  p.pop -= +v["Haushalte"];
			  p.ant = p.tot/p.pop;
              return p;
          },
          function () { return {n:0,tot:0,pop:0,ant:0}; }
		);
		
		var wohnungen = states.group().reduceSum(function (d) {
            return +d["Wohnungen"];
        });
		
		var wohnungenTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Wohnungen"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Wohnungen"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var neuewohnungen = states.group().reduceSum(function (d) {
            return +d["Neuerstellte Wohnungen"];
        });
		
		var neuewohnungenTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Neuerstellte Wohnungen"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Neuerstellte Wohnungen"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var volksschülerInnen = states.group().reduceSum(function (d) {
            return +d["Volksschüler"];
        });
		
		var volksschülerTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Volksschüler"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Volksschüler"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var betriebegroup = states.group().reduceSum(function (d) {
            return +d["Betriebe"];
        });
		
		var betriebeTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Betriebe"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Betriebe"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var beschäftigtegroup = states.group().reduceSum(function (d) {
			return +d["Beschäftigte"];
        });
		
		var beschäftigteTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Beschäftigte"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Beschäftigte"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var steuerfussgroup = states.group().reduceSum(function (d) {
			return +d["Steuerfuss"];
        });
		
		var SteuerfussTotal = data.groupAll().reduce(
          function (p, v) {
              ++p.n;
              p.tot += +v["Steuerfuss"];
              return p;
          },
          function (p, v) {
              --p.n;
              p.tot -= +v["Steuerfuss"];
              return p;
          },
          function () { return {n:0,tot:0}; }
		);
		
		var altersstrukturStack=data.dimension(function (d) {
			return d["Alterskategorie"];
		});
				
		var AltersstrukturGroup= altersstrukturStack.group().reduce(function(p, v) {
			++p.count;
			if (v["GeschlechtNation"]=="Schweizerinnen" | v["GeschlechtNation"]=="Ausländerinnen") {
				p["Negativ"] = (p["Negativ"] || 0) + +v["AnzahlPersonen"];
				p[v["GeschlechtNation"]] = (p[v["GeschlechtNation"]] || 0) - +v["AnzahlPersonen"];
			}
			else {
				p[v["GeschlechtNation"]] = (p[v["GeschlechtNation"]] || 0) + +v["AnzahlPersonen"];
			}
			p.total += +v["AnzahlPersonen"];
			return p;
		}, function(p, v) {
			--p.count;
			if (v["GeschlechtNation"]=="Schweizerinnen" | v["GeschlechtNation"]=="Ausländerinnen") {
				p["Negativ"] = (p["Negativ"] || 0) - +v["AnzahlPersonen"];
				p[v["GeschlechtNation"]] = (p[v["GeschlechtNation"]] || 0) + +v["AnzahlPersonen"];
			}
			else {
				p[v["GeschlechtNation"]] = (p[v["GeschlechtNation"]] || 0) - +v["AnzahlPersonen"];
			}
			p.total -= +v["AnzahlPersonen"];
			return p;
		}, function() {
			return { total:0, count:0};
		});
		var RealAltersstrukturGroup = remove_bins(AltersstrukturGroup)
		
		var altersstrukturkategorien = data.dimension(function (d) {
			return d["GeschlechtNation"];
		});
		var altersstrukturGroup2 = altersstrukturkategorien.group().reduceSum(function (d) {
			return +d["AnzahlPersonen"];
		});
		var AnzahlPersonenTotal = data.groupAll().reduceSum(function (d) {
			return d["AnzahlPersonen"];
		});
		
		var SektorDimension = data.dimension(function (d) {
			return d["Sektor"];
		});
		var BetriebenachSektorGroup = SektorDimension.group().reduceSum(function (d) {
			return d["BetriebenachSektor"];
		});
		var RealBetriebenachSektorGroup = remove_bins(BetriebenachSektorGroup);
		var BeschäftigtenachSektorGroup = SektorDimension.group().reduceSum(function (d) {
			return d["BeschäftigtenachSektor"];
		});
		var RealBeschäftigtenachSektorGroup = remove_bins(BeschäftigtenachSektorGroup);
		
		var ZoneDimension = data.dimension(function (d) {
			return d["Zone"];
		});
		var FlächenachZoneGroup = ZoneDimension.group().reduceSum(function (d) {
			return d["Fläche"];
		});
		var RealFlächenachZoneGroup = remove_bins(FlächenachZoneGroup)
		
		var FlächeTotal = data.groupAll().reduceSum(function (d) {
			return d["Fläche"];
		});
		
		function sel_stack(i) {
			return function(d) {
				return d.value[i];
			};
		};
		
		var average = function(d) {
			return d.n ? d.tot / d.n : 0;
		};
		
		var total = function(d) {
			return d.tot;
		};
		
		var anteil = function(d) {
			return d.ant;
		};
		
		var rowCount = function(d) {
			return d.n;
		};

var redrawx=0;
		
function redraw() {

		//Karte
		
		var totalWidth = document.getElementById('karte').offsetWidth;
		var mapheight = 350
		var heightmax = 350
		var heightmin = 240
		var mapheight = Math.min( heightmin + (totalWidth - 286)*1, heightmax);
		var scale = 75000
		var scalemax = 75000
		var scalemin = 50000
		var scale = Math.min( scalemin + (totalWidth - 286)*180.5, scalemax);
		var lat = 8.548589899
		var lon = 47.15309567
		

		
		var projection = d3.geo.mercator()
			.center([lat,lon])
			.scale(scale)
			.translate([totalWidth / 2 , mapheight / 2 ]);
			//.translate([totalWidth/2,height/2]);

		d3.json("data/gemeinden.json", function (statesJson) {
            
			var gemeinden=["Baar", "Cham", "Hünenberg", "Menzingen", "Neuheim", "Oberägeri", "Risch", "Steinhausen", "Unterägeri", "Walchwil" ,"Zug", "See"]
			
			karte.width(totalWidth)
                    .height(mapheight)
                    .dimension(states)
                    .group(einwohner)
					.colors(d3.scale.ordinal().domain(gemeinden)
						.range([colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], colorscheme[1][1][0], "#ebf4fa"]))
					.colorAccessor(function(d) { 
						return d ? d.key : "See";
					})
                    //.colors(d3.scale.quantize().range(["#E2F2FF", "#C4E4FF", "#9ED2FF", "#81C5FF", "#6BBAFF", "#51AEFF", "#36A2FF", "#1E96FF", "#0089FF", "#0061B5"]))
                    //.colorDomain([0, 200])
                    //.colorCalculator(function (d) { return d ? karte.colors()(d) : '#ccc'; })
					.projection(projection)
                    .overlayGeoJson(statesJson.features, "state", function (d) {
                        return d.properties.name;
                    })
					.valueAccessor(function(kv) {
						return kv.value;
					})
                    .title(function (d) {
                        return "State: " + d.key + "\nTotal Amount Raised: " + numberFormat(d.value ? d.value : 0) + "M";
                    })
					.addFilterHandler(function (filters, filter) {
						if (filter != "Zugersee" && filter != "Aegerisee") {
							$('#mainflag').attr("src", "logos/"+ filter.toLowerCase().replace("ü", "ü").replace("ä", "ä")+ ".png")
							$('#maintitle').html("Gemeindeporträt "+filter);
							$('.gemeindename').html("Gemeinde "+filter);
							filters.length = 0; // empty the array
							filters.push(filter);
						}
						return filters;
					})
					.removeFilterHandler(function (filters, filter) {
						$('#mainflag').attr("src", "logos/kanton.png")
						$('#maintitle').html("Kantonsporträt");
						$('.gemeindename').html("Kanton Zug");
						filters.length = 0;
						return filters;
					});
					;
			
			var number=1;
			
			dc.override(karte, "filterAll", function () {
				$('#mainflag').attr("src", "logos/kanton.png")
				$('#maintitle').html("Kantonsporträt");
				$('.gemeindename').html("Kanton Zug");
				var g = this._filterAll();
				return g;
			});
			
			bevölkerung
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(einwohnerTotal);
				
			ausländeranteil
				.valueAccessor(anteil).formatNumber(d3.format('.1%'))
				.group(ausländerTotal);
				
			haushalte
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(haushalteTotal);
				
			anteileinpersonenhaushalte
				.valueAccessor(anteil).formatNumber(d3.format('.1%'))
				.group(einpersonenhaushalteTotal);
				
			bestandwohnungen
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(wohnungenTotal);
			
			neuwohnungen
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(neuewohnungenTotal);
				
			volksschüler
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(volksschülerTotal);
				
			betriebe
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(betriebeTotal);

			beschäftigte
				.valueAccessor(total).formatNumber(germanFormatters.numberFormat(","))
				.group(beschäftigteTotal);
			
			steuerfuss
				.valueAccessor(function (d) {
					var steuerfuss=d.tot
					if (steuerfuss>200) { steuerfuss=data7[11].Steuerfuss}
					return steuerfuss;
				}).formatNumber(germanFormatters.numberFormat(","))
				.group(SteuerfussTotal);
	
			for (i = 0; i < Realeinwohnerprojahr.all().length; i++) {
				if (typeof min == 'undefined' || min > Realeinwohnerprojahr.all()[i].key) {var min = Realeinwohnerprojahr.all()[i].key};
				if (typeof max == 'undefined' || max < Realeinwohnerprojahr.all()[i].key) {var max = Realeinwohnerprojahr.all()[i].key};
			}
			
			var height=Math.min(500, (1.2*totalWidth));
			
			entwicklungsChart
				.width(totalWidth)
				.height(height)
				.transitionDuration(1500)
				.margins({left: 65, top: 10, right: 50, bottom: 30})
				.dimension(jahr)
				.group(Realeinwohnerprojahr)
				.x(d3.scale.linear().domain([min-1,max+1]))
				//.x(d3.scale.ordinal())
				//.xUnits(dc.units.ordinal)
				.elasticY(true)
				.brushOn(false)
				._rangeBandPadding(1)
				.compose([
					dc.barChart(entwicklungsChart)
						.group(Realeinwohnerprojahr, "Bevölkerung")
						.ordinalColors([colorscheme[1][2][0]])
						.yAxisPadding("15%")
						.gap(totalWidth/200)
						.centerBar(true)
						.title(function(d) {
							return ""; 
						}),
					dc.lineChart(entwicklungsChart)
						.group(Realausländeranteilprojahr, "Anteil Ausländer/innen in %")
						.valueAccessor(function (d) {
							return d.value.ant;
						})
						.yAxisPadding("10%")
						.ordinalColors([colorscheme[1][2][1]])
						.useRightYAxis(true)
						.interpolate("linear")
						.dotRadius(10)
						.title(function(d) {
							return ""; 
						})
				])
				.yAxisLabel("Bevölkerung")
				.rightYAxisLabel("Anteil Ausländer/innen in %")
				.renderHorizontalGridLines(true)
				.legend(dc.legend().x(20).y(height-15).itemHeight(13).gap(10)
				.horizontal(true)
				.legendWidth(totalWidth-10)
				.autoItemWidth(true))
				.filter = function() {}
				;
			
			entwicklungsChart.yAxis().tickFormat(germanFormatters.numberFormat(","));
			entwicklungsChart.xAxis().tickFormat(germanFormatters.numberFormat(""));
			entwicklungsChart.rightYAxis().tickFormat(d3.format('.0%'));
			
			function getLegendWidth() {
				var legendLength = d3.select("#entwicklung-chart g.dc-legend").node().childElementCount;
				var legendWidthArray = [];
				legendHeightArray = [];
				for (i=0; i < legendLength; i++) {
					var j=i+1;
					var item = "#entwicklung-chart g.dc-legend-item:nth-of-type("+j+")";
					legendWidthArray[i]=d3.select(item).node().getBBox().width;
					legendHeightArray[i]=d3.select(item).node().getBBox().height;
				};
				legendMaxWidth = Math.max.apply(null, legendWidthArray);
			}
			
			function rotateXentwicklung(){
				//Breite eines Zwischenstrichs
				var tickwidth=d3.transform(d3.selectAll("#entwicklung-chart g.axis.x > g.tick:nth-child(2)").attr("transform")).translate[0]-d3.transform(d3.selectAll("#entwicklung-chart g.axis.x > g.tick:nth-child(1)").attr("transform")).translate[0];;

				//Zeilen umbrechen, wenn breiter als Zwischenstrich
				entwicklungsChart.selectAll(".x .tick text")
					.call(wrap, tickwidth);

				//Maximale Breite der Skalenbezeichner	
				maxwidth=0
				maxheight=0
				entwicklungsChart.selectAll("#entwicklung-chart g.axis.x > g > text")
					.attr('transform', function (d) {
						var coordx = this.getBBox().width;
						if (maxwidth < coordx) {
							maxwidth = coordx;
						}
						var coordy = this.getBBox().height;
						if (maxheight < coordy) {
							maxheight = coordy;
						}
					});

				legendy=height-40+maxheight
				d3.selectAll("#entwicklung-chart g.dc-legend").attr("transform", "translate(10,"+legendy+")")
				var legendHeight = d3.select("#entwicklung-chart g.dc-legend").node().getBBox().height;
				entwicklungsChart.height(height+maxheight+legendHeight-30)
					.margins({left: 65, top: 10, right: 50, bottom: (30 + maxheight + legendHeight)});
				entwicklungsChart.render()
				entwicklungsChart.selectAll(".x .tick text")
					.call(wrap, tickwidth);
				d3.selectAll("#entwicklung-chart g.dc-legend").attr("transform", "translate(10,"+legendy+")")
				maxwidth=0
				maxheight=0
				entwicklungsChart.selectAll("#entwicklung-chart g.axis.x > g > text")
					.attr('transform', function (d) {
						var coordx = this.getBBox().width;
						if (maxwidth < coordx) {
							maxwidth = coordx;
						}
						var coordy = this.getBBox().height;
						if (maxheight < coordy) {
							maxheight = coordy;
						}
					});
				//Wenn immer noch zu breit dann rotieren
				if (maxwidth-6>tickwidth*0.75) {
				entwicklungsChart.height(height+Math.min(150, maxwidth)+legendHeight-30)
					.margins({left: 65, top: 10, right: 50, bottom: 30 +Math.min(150, maxwidth) + legendHeight});
				entwicklungsChart.render()
				entwicklungsChart.selectAll(".x .tick text")
					.call(wrap, Math.min(150, maxwidth));
				legendy=height-40+Math.min(150, maxwidth)
				d3.selectAll("#entwicklung-chart g.dc-legend").attr("transform", "translate(10,"+legendy+")")
				d3.selectAll("#entwicklung-chart g.axis.x > g > text")
					.style("text-anchor", "start")
				//var moveleft = (-maxheight)/2-3
				d3.selectAll("#entwicklung-chart g.axis.x > g > text").attr("transform", function (d) {
					var moveleft = (-(this.getBBox().height)/2)-5;
					return ("rotate(90), translate(10,"+moveleft+")")
				});
				}
				//Wenn nötig Legende umbrechen, funktioniert nur bis 2 Zeilen.
				getLegendWidth();
				if (legendMaxWidth > totalWidth-30){
					entwicklungsChart.selectAll("#entwicklung-chart g.dc-legend text")
						.call(wrap, totalWidth-30);
				d3.selectAll("#entwicklung-chart g.dc-legend text").attr("transform", function (d) {
					var height = (this.getBBox().height);
					if(height == 14) {
					return ("translate(0,0)")
					}
					if(height > 15) {
					return ("translate(0,-6)")
					}
				});
				}
				$("#entwicklung-chart .dc-legend-item text").attr("x", 17);
				
				var transx=d3.transform(d3.selectAll("#entwicklung-chart g.chart-body:nth-child(2)").attr("transform")).translate[0];
				var transy=d3.transform(d3.selectAll("#entwicklung-chart g.chart-body:nth-child(2)").attr("transform")).translate[1];
				d3.selectAll("#entwicklung-chart g.chart-body").attr("transform", "translate("+transx+","+transy+")")
			}

			var characteristics=["Schweizerinnen", "Ausländerinnen", "Negativ", "Schweizer", "Ausländer"]
			var characteristicsStack=["0-4", "5-9", "10-14", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84", "85-89", "90-94", "95-99", "100+"]
			var colorsAltersstruktur=[colorscheme[1][4][2], colorscheme[1][4][3],  ,colorscheme[1][4][1], colorscheme[1][4][0]];
			
			altersstrukturChart
				.width(Math.min(500, totalWidth))
				.height(Math.min(500, totalWidth))
				.x(d3.scale.ordinal())
				.xUnits(dc.units.ordinal)
				.margins({left: 50, top: 10, right: 10, bottom: 40})
				.brushOn(false)
				.barPadding(0.2)
				.outerPadding(0.2)
				.centerBar(false)
				//.clipPadding(1)
				.controlsUseVisibility(true)
				.title(function(d) {
					return ""; //d.key + '[' + this.layer + ']: ' + d.value[this.layer] + " " + d.value["total"];
				})
				.dimension(altersstrukturStack)
				.group(RealAltersstrukturGroup, characteristics[0] + "", sel_stack(characteristics[0]))
				//.renderLabel(true)
				.ordinalColors(colorsAltersstruktur)
				.transitionDuration(1500)
				.yAxisPadding("5%")
				.elasticY(true)
				.filter = function() {}
				;

			if (typeof relative !== 'undefined' && relative==true) {
				altersstrukturChart.yAxis().tickFormat(d3.format('.0%'));
				altersstrukturChart.renderLabel(false)
				altersstrukturChart.yAxisPadding("0%");
			}
			else {
				//altersstrukturChart.yAxis().tickFormat(germanFormatters.numberFormat(","));	
			}

			if (typeof characteristicsStack !== []) {
			altersstrukturChart.x(d3.scale.ordinal().domain(characteristicsStack));
			}

			//Farben in der Legende manuell zuweisen. funktionier nicht mit der Legende.
			/*Charts[number].on('renderlet', function(chart){
				for (var i=1; i<=characteristicsLength; ++i) {
				var j=i-1;
				chart.selectAll("g.stack._"+j+" > rect").attr("fill", function(d){
					return colorscheme[scale][characteristicsLength][i-1];
					
				});
				chart.selectAll("g.dc-legend-item:nth-child("+i+") > rect").attr("fill", function(d){
					return colorscheme[scale][characteristicsLength][i-1];
					
				});}
				})*/

			altersstrukturChart.legend(dc.legend().x(10).y(10).itemHeight(13).gap(10)
						.horizontal(false)
						//.legendWidth(500-10)
						.autoItemWidth(true));

			if (redrawx==0) {
			
			//Legende Anders ordnen
			dc.override(altersstrukturChart, 'legendables', function() {
				var items = altersstrukturChart._legendables();
				items.splice(2, 1);
				items.splice(3, 1, items.splice(2, 1)[0])
				items.splice(3, 1, items.splice(0, 1)[0])
				items.splice(3, 1, items.splice(0, 1)[0])
				return items;
			});
			
			}
			
			redrawx=redrawx+1;

			for(var i = 1; i < 5; ++i){
				altersstrukturChart.stack(RealAltersstrukturGroup, characteristics[i], sel_stack(characteristics[i]));
			}
			
			altersstrukturChart.on('pretransition', function(c) {
				c.svg().select('g').attr("transform","rotate(270 "+(Math.min(500, totalWidth)/2)+", "+(Math.min(500, totalWidth)/2)+")");
				c.svg().selectAll('g.axis:nth-child(2) > g > text').attr("transform","translate(12,25) rotate(90 0,0)");
				c.svg().select('g:nth-child(3) > g:nth-child(3)').attr("transform","translate(12,25) rotate(90 0,0)");
				c.svg().selectAll('g.axis:nth-child(3) > g > text').each(function(d, i) {
					d3.select(this).text(d3.select(this).text().replace("-",""));
				});
			});
			
			altersstrukturChart.yAxis().tickFormat(germanFormatters.numberFormat(","));
			
			var characteristicsWirtschaftsstruktur=["Land- und Forstwirtschaft", "Industrie und Gewerbe", "Dienstleistung"]
			
			var colorScaleWirtschaftstruktur = d3.scale.ordinal()
            .domain(characteristicsWirtschaftsstruktur)
            .range([colorscheme[1][3][2],colorscheme[1][3][1],colorscheme[1][3][0]]);
			
			var wirtschaftsHeight=Math.min(500, totalWidth);
			
			wirtschaftsstrukturChart1.width(totalWidth)
				.cx(totalWidth/2)
				.cy(Math.min(500, totalWidth)/2)
				.height(wirtschaftsHeight)
				.slicesCap(15)
				.dimension(SektorDimension)
				.group(RealBetriebenachSektorGroup)
				.controlsUseVisibility(true)
				.externalRadiusPadding(0.1*wirtschaftsHeight)
				.emptyTitle("Keine Daten vorhanden")
				.innerRadius(0.3*wirtschaftsHeight)
				.colors(colorScaleWirtschaftstruktur)
				.transitionDuration(1500)
				.title(function(d) {
					return ""; 
				})
				.ordering(function(d) { return characteristicsWirtschaftsstruktur.indexOf(d.key); })
				.legend(dc.legend().x(10).y(10).itemHeight(13).gap(10)
					.horizontal(false))
				.on('renderlet', function(chart){
					//Labels mit Prozentzahlen ersetzen
					chart.selectAll('text.pie-slice').text( function(d) {
						if (dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI) * 100) > 3) {
							return d3.format(".1%")(dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI)*100)/100);
						};
					});
				})
				.filter = function() {}
				;
				
			wirtschaftsstrukturChart2.width(totalWidth)
				.cx(totalWidth/2)
				.cy(Math.min(500, totalWidth)/2)
				.height(wirtschaftsHeight)
				.slicesCap(15)
				.dimension(SektorDimension)
				.group(RealBeschäftigtenachSektorGroup)
				.controlsUseVisibility(true)
				.externalRadiusPadding(0.2*wirtschaftsHeight)
				.emptyTitle("Keine Daten vorhanden")
				.innerRadius(0.2*wirtschaftsHeight)
				.colors(colorScaleWirtschaftstruktur)
				.transitionDuration(1500)
				.title(function(d) {
					return ""; 
				})
				.ordering(function(d) { return characteristicsWirtschaftsstruktur.indexOf(d.key); })
				.on('renderlet', function(chart){
					//Labels mit Prozentzahlen ersetzen
					chart.selectAll('text.pie-slice').text( function(d) {
						if (dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI) * 100) > 3) {
							return d3.format(".1%")(dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI)*100)/100);
						};
					});
				})
				.filter = function() {}
				;
			
			characteristicsBauzonen=["Wohnzonen", "Mischzonen", "Kernzonen", "Arbeitszonen", "Öffentliche Bauten und Anlagen (OeIB)", "Bauzonen mit besonderen Vorschriften, weitere Zonen"]
			
			var colorScaleBauzonen = d3.scale.ordinal()
				.domain(characteristicsBauzonen)
				.range(colorscheme[1][6]);
			
			var bauzonenHeight=Math.min(400, (1*totalWidth));
			
			bauzonenChart
				.width(totalWidth)
				.height(bauzonenHeight)
				.x(d3.scale.ordinal())
				.xUnits(dc.units.ordinal)
				.margins({left: 50, top: 10, right: 10, bottom: 20})
				.brushOn(false)
				.barPadding(0.2)
				.outerPadding(0.2)
				.centerBar(false)
				//.clipPadding(1)
				.controlsUseVisibility(true)
				.title(function(d) {
					return ""; //d.key + '[' + this.layer + ']: ' + d.value[this.layer] + " " + d.value["total"];
				})
				.dimension(ZoneDimension)
				.group(RealFlächenachZoneGroup)
				.renderLabel(true)
				.elasticY(true)
				.colors(colorScaleBauzonen)
				.colorAccessor(function(d) { 
					return d.key
				})
				//.ordinalColors([colorscheme[1][12][11], colorscheme[1][12][3], colorscheme[1][12][2], colorscheme[1][12][0], colorscheme[1][12][0]])
				.transitionDuration(1500)
				.yAxisPadding("5%")
				.ordering(function(d) { return characteristicsBauzonen.indexOf(d.key); })
				.filter = function() {}
				;
				
			bauzonenChart.on('renderlet', function(c) {
				d3.selectAll("#bauzonen-chart text.barLabel").each(function(d, i) {
					if (d.data.value % 1) {wert=(germanFormatters.numberFormat(",.1f")(d.data.value))+" ha"}
					else {wert=(germanFormatters.numberFormat(",")(d.data.value))+" ha"}
					d3.select(this).text(wert);
				});
			});
				
			function rotateXbauzonen(){
				//Breite eines Zwischenstrichs
				var tickwidth=d3.transform(d3.selectAll("#bauzonen-chart g.axis.x > g.tick:nth-child(2)").attr("transform")).translate[0]-d3.transform(d3.selectAll("#bauzonen-chart g.axis.x > g.tick:nth-child(1)").attr("transform")).translate[0];;

				//Zeilen umbrechen, wenn breiter als Zwischenstrich
				bauzonenChart.selectAll(".x .tick text")
					.call(wrap, tickwidth);

				//Maximale Breite der Skalenbezeichner
				var maxwidth=0
				var maxheight=0
				bauzonenChart.selectAll("#bauzonen-chart g.axis.x > g > text")
					.attr('transform', function (d) {
						var coordx = this.getBBox().width;
						if (maxwidth < coordx) {
							maxwidth = coordx;
						}
						var coordy = this.getBBox().height;
						if (maxheight < coordy) {
							maxheight = coordy;
						}
					});

				bauzonenChart.height(bauzonenHeight+maxheight-20)
					.margins({left: 50, top: 10, right: 10, bottom: 10 + maxheight});
				bauzonenChart.render()
				bauzonenChart.selectAll(".x .tick text")
					.call(wrap, tickwidth);
				var maxwidth=0
				var maxheight=0
				bauzonenChart.selectAll("#bauzonen-chart g.axis.x > g > text")
					.attr('transform', function (d) {
						var coordx = this.getBBox().width;
						if (maxwidth < coordx) {
							maxwidth = coordx;
						}
						var coordy = this.getBBox().height;
						if (maxheight < coordy) {
							maxheight = coordy;
						}
					});
				//Wenn immer noch zu breit dann rotieren
				if (maxwidth-6>tickwidth*0.75) {
				bauzonenChart.height(bauzonenHeight+Math.min(150, maxwidth)-20)
					.margins({left: 50, top: 10, right: 10, bottom: 10 + +Math.min(150, maxwidth)});
				bauzonenChart.render()
				bauzonenChart.selectAll(".x .tick text")
					.call(wrap, Math.min(150, maxwidth));
				d3.selectAll("#bauzonen-chart g.axis.x > g > text")
					.style("text-anchor", "start")
				//var moveleft = (-maxheight)/2-3
				d3.selectAll("#bauzonen-chart g.axis.x > g > text").attr("transform", function (d) {
					var moveleft = (-(this.getBBox().height)/2)-5;
					return ("rotate(90), translate(10,"+moveleft+")")
				});
				}
				//Click-Event ausschalten
				d3.selectAll("#bauzonen-chart g.stack > rect").on('click',null);
				d3.selectAll("#bauzonen-chart g.stack > rect").on("click", function() {
				});
			}

            dc.renderAll();
			
			rotateXentwicklung();
			rotateXbauzonen();
			
			function callTipKarte(number){
	
				//Nur für Gemeinden, nicht für Seen, deshalb Zwischenschritt
				var gemeinden = d3.selectAll("#karte svg g path").filter(function(d,i) {return d.id < 2000});
				
				gemeinden.each(function(d, i){
					d3.select(this)
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.key !== last_tip) {
							Tips[number].show(d, $("circle")[d.ind]);
							last_tip = d.key;
						}
						tiptext= "<span><b>" + d.properties.name + "</b></span><br/><br/><span><img src='logos/"+ d.properties.name+ ".png' alt=''></span>";
						$("#d3-tip"+number).html(tiptext);
						$("#d3-tip"+number).css("background", "#fff");
						$("#d3-tip"+number).css("border-left", colorscheme[1][2][0]+" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 18 - ($("#d3-tip"+number).width()/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) + 0 - ($("#d3-tip"+number).height()));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
					})
				})
			}
			
			function callTipBevölkerungsentwicklung(number){
				d3.selectAll("#entwicklung-chart g.stack > rect")
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.key !== last_tip) {
							Tips[number].show(d);
							last_tip = d.key;
						}
						if (d.data.value % 1) {wert=germanFormatters.numberFormat(",.1f")(d.data.value)}
						else {wert=germanFormatters.numberFormat(",")(d.data.value)}
						tiptext= "<span>" + d.data.key + "</span><br/><span>Einwohnerzahl: " +wert+  "</span>";
						$("#d3-tip"+number).html(tiptext)
						$("#d3-tip"+number).css("border-left", colorscheme[1][2][0]+" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 33 - (($("#d3-tip"+number).width()+30)/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) +5 - (($("#d3-tip"+number).height()+18)/2));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
					});
				d3.selectAll("circle.dot")
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.data.key !== last_tip) {
							Tips[number].show(d);
							last_tip = d.data.key;
						}
						tiptext= "<span>" + d.data.key + "</span><br/><span>Anteil: " + d3.format('.1%')(d.data.value.ant) + "</span>";
						$("#d3-tip"+number).html(tiptext)
						$("#d3-tip"+number).css("border-left", colorscheme[1][2][1] +" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 33 - (($("#d3-tip"+number).width()+30)/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) + 5 - (($("#d3-tip"+number).height()+18)/2));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
						//document.getElementsByClassName("dot")
						d3.selectAll("circle.dot").attr('style', "fill-opacity:0.000001");
						d3.selectAll("path.yRef").attr('style', "display:none");
						d3.selectAll("path.xRef").attr('style', "display:none");
					});
			}
			
			function callTipAltersstruktur(number){
				d3.selectAll("#altersstruktur-chart g.stack > rect")
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.key !== last_tip) {
							Tips[number].show(d);
							last_tip = d.key;
						}
						if (d.data.value[characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]] % 1) {wert=germanFormatters.numberFormat(",.1f")(Math.abs(d.data.value[characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]]))}
						else {wert=germanFormatters.numberFormat(",")(Math.abs(d.data.value[characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]]))}
						tiptext= "<span>"+characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]+" "+ d.data.key+ " Jahre</span><br/><span>Anteil in der Altersgruppe: " + Math.abs((Math.round((d.data.value[characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]]/d.data.value["total"])*1000)/10).toFixed(1)) + '%' + "</span><br/><span>Anteil Gesamtbevölkerung: " + Math.abs((Math.round((d.data.value[characteristics[Math.floor(i/RealAltersstrukturGroup.all().length)]]/AnzahlPersonenTotal.value())*1000)/10).toFixed(1)) + '%' + " </span><br/><span>Anzahl: " + wert +  "</span>";
						$("#d3-tip"+number).html(tiptext)
						$("#d3-tip"+number).css("border-left", colorsAltersstruktur[Math.floor(i/RealAltersstrukturGroup.all().length)] +" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 33 - (($("#d3-tip"+number).width()+30)/2) + ((d3.selectAll("#altersstruktur-chart g.stack > rect")[0][i].height.baseVal.value)/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) + 5 - ($("#d3-tip"+number).height()+18/2));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
					});
			}

			function callTipWirtschaftsstruktur(number){
				d3.selectAll("#wirtschaftsstruktur"+number+"-chart g.pie-slice, #wirtschaftsstruktur"+number+"-chart text.pie-slice")
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.key !== last_tip) {
							Tips[number].show(d, $("#wirtschaftsstruktur"+number+"-chart g.pie-slice")[characteristicsWirtschaftsstruktur.indexOf(d.data.key)]);
							last_tip = d.key;
						}
						if (d.data.value % 1) {wert=germanFormatters.numberFormat(",.1f")(d.data.value)}
						else {wert=germanFormatters.numberFormat(",")(d.data.value)}
						if (number==1) {var gruppe="Anzahl Betriebe"} else {var gruppe="Anzahl Beschäftigte"};
						tiptext="<span>" + d.data.key + "</span><br/>Anteil: " + germanFormatters.numberFormat(",.1%")(dc.utils.printSingleValue((d.endAngle - d.startAngle) / (2*Math.PI)*100)/100) + "</span><br/><span>"+gruppe+": " + wert + "</span>"
						$("#d3-tip"+number).html(tiptext)
						$("#d3-tip"+number).css("border-left", colorScaleWirtschaftstruktur(d.data.key)+" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 18 - ($("#d3-tip"+number).width()/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) -10 - ($("#d3-tip"+number).height()/2));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
					});
			}
			
			function callTipBauzonen(number){
				d3.selectAll("#bauzonen-chart g.stack > rect")
					.call(Tips[number])
					.on('mouseover', function(d, i) {
						if(d.key !== last_tip) {
							Tips[number].show(d);
							last_tip = d.key;
						}
						if (d.data.value % 1) {wert=germanFormatters.numberFormat(",.1f")(d.data.value)}
						else {wert=germanFormatters.numberFormat(",")(d.data.value)}
						tiptext= "<span>" + d.data.key + "</span><br/><span>Anteil: " + germanFormatters.numberFormat(",.1%")(d.data.value/FlächeTotal.value()) + "</span><br/><span>Fläche: " +wert+  " ha</span>";
						$("#d3-tip"+number).html(tiptext)
						$("#d3-tip"+number).css("border-left", colorScaleBauzonen(d.data.key)+" solid 5px");
						offsetx=(Number($("#d3-tip"+number).css( "left" ).slice(0, -2)) + 20 - ($("#d3-tip"+number).width()/2));
						offsety=(Number($("#d3-tip"+number).css( "top" ).slice(0, -2)) -18 - ($("#d3-tip"+number).height()/2));
						$("#d3-tip"+number).css( 'left', offsetx);
						$("#d3-tip"+number).css( 'top', offsety);
					})
					.on('mouseout', function(d) {
						last_tip = null;
						Tips[number].hide(d);
					});
			}
			
			
			
			callTipKarte("karte");
			callTipBevölkerungsentwicklung("bevölkerungsentwicklung");
			callTipAltersstruktur("altersstruktur");
			callTipWirtschaftsstruktur(1);
			callTipWirtschaftsstruktur(2);
			callTipBauzonen("bauzonen");
			
$(".dc-legend-item text").attr("x", 17);
$("title").remove();
//$("#altersstruktur-chart g.axis.y g.tick text").text($("#altersstruktur-chart g.axis.y g.tick text").text().replace('-', ''));
		
//Kuchendiagramm mit Pfeilen ergänzen

$( document ).ready(function() {
	setTimeout(function() {
	
		var arrowhead="M374.203,1150c-25.391,0-50.818-9.721-70.199-29.044c-38.789-38.834-38.789-101.685,0-140.376L685.37,599.14L305.74,219.451c-38.716-38.741-38.716-101.614,0-140.379c38.799-38.763,101.663-38.763,140.389,0l449.857,449.915 c18.58,18.629,29.103,43.84,29.103,70.153c0,26.339-10.523,51.551-29.103,70.226l-451.592,451.59 C425.012,1140.279,399.621,1150,374.203,1150z"
		var markerblack={"id":"arrowblack", "viewBox":"0 -5 1200 1200", "refX":-200, "refY":600, "markerWidth":3, "markerHeight":3, "orient":"auto"};
		
		svg = d3.selectAll("#wirtschaftsstruktur1-chart svg")
		
		min=269
		max=500
		
		svg.selectAll("marker").remove();
		svg.selectAll(".arrow").remove();
		svg.selectAll(".arrowtext").remove();
		
		
		svg.append("marker")
			.attr(markerblack)
			.append("path")
				.attr("d", arrowhead)
				.attr("class","arrowHead")
				.attr("fill", "#32444a")
				//.attr("fill-opacity", "0.5");
						
		svg.append("path")
			.attr("class", "arrow")
			.attr("id", "line1")
			.attr("stroke-width", (0.01*wirtschaftsHeight))
			.attr("stroke", "#32444a")
			.attr("fill", "none")
			.attr("stroke-linecap", "round")
			//.attr("stroke-opacity", "0.5")
			.attr("marker-end", "url(#arrowblack)")
			.attr("d", function(d) {
				/*var scalewidth=1*d3.transform(svg.select("g.axis.y").attr("transform")).translate[0];
				var rectwidth=svg.select("g.sub._0 rect:nth-child(1)").attr("width");
				var y1=svg.select("g.sub._0 rect:nth-child(1)").attr("y")-5;
				var x1=(1*svg.select("g.sub._0 rect:nth-child(1)").attr("x"))+scalewidth+rectwidth/2;
				var y2=svg.select("g.sub._0 rect:nth-child(2)").attr("y")-5;
				var x2=(1*svg.select("g.sub._0 rect:nth-child(2)").attr("x"))+scalewidth+rectwidth/2-20;*/
				return "M"+((totalWidth/2)-(0.08*wirtschaftsHeight))+","+((wirtschaftsHeight/2)-(0.04*wirtschaftsHeight))+" "+((totalWidth/2)+(0.32*wirtschaftsHeight))+" "+((wirtschaftsHeight/2)-(0.04*wirtschaftsHeight));
			});
				
		svg.append("text")
			.attr("class", "arrowtext")
			.attr("x", ((totalWidth/2)-(0.08*wirtschaftsHeight)))
			.attr("y", ((wirtschaftsHeight/2)-(0.06*wirtschaftsHeight)))
			.attr("font-size", (10+(0.02*wirtschaftsHeight)))
			.attr("fill", "#32444a")
			.text("Betriebe");	
				
		svg.append("path")
			.attr("class", "arrow")
			.attr("id", "line2")
			.attr("stroke-width", (0.01*wirtschaftsHeight))
			.attr("stroke", "#32444a")
			.attr("fill", "none")
			.attr("stroke-linecap", "round")
			//.attr("stroke-opacity", "0.5")
			.attr("marker-end", "url(#arrowblack)")
			.attr("d", function(d) {
				/*var scalewidth=1*d3.transform(svg.select("g.axis.y").attr("transform")).translate[0];
				var rectwidth=svg.select("g.sub._0 rect:nth-child(1)").attr("width");
				var y1=svg.select("g.sub._0 rect:nth-child(1)").attr("y")-5;
				var x1=(1*svg.select("g.sub._0 rect:nth-child(1)").attr("x"))+scalewidth+rectwidth/2;
				var y2=svg.select("g.sub._0 rect:nth-child(2)").attr("y")-5;
				var x2=(1*svg.select("g.sub._0 rect:nth-child(2)").attr("x"))+scalewidth+rectwidth/2-20;*/
				return "M"+((totalWidth/2)-(0.08*wirtschaftsHeight))+","+((wirtschaftsHeight/2)+(0.06*wirtschaftsHeight))+" "+((totalWidth/2)+(0.21*wirtschaftsHeight))+" "+((wirtschaftsHeight/2)+(0.06*wirtschaftsHeight));
			});
			
		svg.append("text")
			.attr("class", "arrowtext")
			.attr("x", ((totalWidth/2)-(0.08*wirtschaftsHeight)))
			.attr("y", ((wirtschaftsHeight/2)+(0.04*wirtschaftsHeight)))
			.attr("font-size", (10+(0.02*wirtschaftsHeight)))
			.attr("fill", "#32444a")
			.text("Beschäftigte");	
				
    }, 1000);
	
});

			$("g.stack:nth-child(3)").hide();
			$('#wirtschaftsstruktur1-chart').css( 'pointer-events', 'none' );
			$('.pie-slice').css( 'pointer-events', 'all' );
			$('.zugersee').css( 'pointer-events', 'none' );
			$('.aegerisee').css( 'pointer-events', 'none' );
			//$('g.aegerisee').css( 'pointer-events', 'none' );
			$( document ).ready(function() {
			setTimeout(
				function() 
				{

				}, 1000);
			});
        });
	}

	if (typeof Tips == 'undefined') { Tips = {} };
			
	function initTip(number){
		last_tip = null;
		Tips[number] = d3.tip()
			.attr('class', 'd3-tip')
			.attr('id', 'd3-tip'+number)
			.direction('n')
			.offset([0, 0])
			.html("no data");
		$(".pie-label").css( 'pointer-events', 'none' );
	}

	initTip("karte");
	initTip("bevölkerungsentwicklung");
	initTip("altersstruktur");
	initTip(1);
	initTip(2);
	initTip("bauzonen");
	
	redraw();

function resizePortrait() {
	d3.selectAll(".d3-tip").remove();
	d3.selectAll("svg").remove()
	redraw()
}

$(window).resize(function(){
		resizePortrait()
});	

});
</script>

</body></html>